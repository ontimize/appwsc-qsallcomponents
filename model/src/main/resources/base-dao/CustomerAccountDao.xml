<?xml version="1.0" encoding="UTF-8"?>
<JdbcEntitySetup xmlns="http://www.ontimize.com/schema/jdbc"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.ontimize.com/schema/jdbc http://www.ontimize.com/schema/jdbc/ontimize-jdbc-dao.xsd"
	table="CUSTOMERACCOUNTS" datasource="mainDataSource" sqlhandler="dbSQLStatementHandler">
	<DeleteKeys>
		<Column>CUSTOMERACCOUNTID</Column>
	</DeleteKeys>
	<UpdateKeys>
		<Column>CUSTOMERACCOUNTID</Column>
	</UpdateKeys>
	<GeneratedKey>CUSTOMERACCOUNTID</GeneratedKey>

	<Queries>
		<Query id="VCUSTOMERACCOUNTBALANCE">
			<Sentence>
				<![CDATA[
					SELECT 
						#COLUMNS#
					FROM (
						SELECT
							CUSTOMERID, ACCOUNTID, ENTITYID, OFFICEID, CDID, ANID, BALANCE, ACCOUNT, STARTDATE, ENDDATE, ACCOUNTTYP, INTERESRATE, CUSTOMERACCOUNTID, CUSTOMERTYPEID, NAME, SURNAME, NAME + ' ' + SURNAME AS CUSTOMER, ADDRESS, COMMENTS, ID, PHONE, EMAIL, COMMENTS_EN_US, COMMENTS_ES_ES, COMMENTS_GL_ES, LONGITUDE, LATITUDE, SIGNATURE, ISOWNER
						FROM (SELECT CUSTOMERACCOUNTS.CUSTOMERID, VACCOUNTBALANCE.ACCOUNTID, VACCOUNTBALANCE.ENTITYID, VACCOUNTBALANCE.OFFICEID, VACCOUNTBALANCE.CDID, VACCOUNTBALANCE.ANID, VACCOUNTBALANCE.BALANCE AS BALANCE, VACCOUNTBALANCE.ENTITYID + ' ' + VACCOUNTBALANCE.OFFICEID + ' ' + VACCOUNTBALANCE.CDID + ' ' + VACCOUNTBALANCE.ANID AS ACCOUNT, VACCOUNTBALANCE.STARTDATE, VACCOUNTBALANCE.ENDDATE, ACCOUNTTYP, INTERESRATE, CUSTOMERACCOUNTID, ISOWNER
							FROM (SELECT ACCOUNTS.ACCOUNTID, ACCOUNTS.ENTITYID, ACCOUNTS.OFFICEID, ACCOUNTS.CDID, ACCOUNTS.ANID, SUM(MOVEMENTS.MOVEMENT) AS BALANCE, ACCOUNTS.STARTDATE, ACCOUNTS.ENDDATE, ACCOUNTS.INTERESRATE, ACCOUNTS.ACCOUNTTYP
								FROM ACCOUNTS
									LEFT OUTER JOIN MOVEMENTS ON ACCOUNTS.ACCOUNTID = MOVEMENTS.ACCOUNTID
								GROUP BY ACCOUNTS.ACCOUNTID, ACCOUNTS.ENTITYID, ACCOUNTS.OFFICEID, ACCOUNTS.CDID, ACCOUNTS.ANID, ACCOUNTS.STARTDATE, ACCOUNTS.ENDDATE, ACCOUNTS.INTERESRATE, ACCOUNTS.ACCOUNTTYP) AS VACCOUNTBALANCE
							INNER JOIN CUSTOMERACCOUNTS ON VACCOUNTBALANCE.ACCOUNTID = CUSTOMERACCOUNTS.ACCOUNTID) AS VTEMP
							INNER JOIN CUSTOMERS ON CUSTOMERS.CUSTOMERID =  VTEMP.CUSTOMERID
						)
					#WHERE#
	          		#ORDER#
				]]>
			</Sentence>
		</Query>
	</Queries>

</JdbcEntitySetup>
